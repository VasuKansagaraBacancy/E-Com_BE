QUICK FIX GUIDE FOR GOOGLE AUTH ERRORS
=======================================

YOU ARE SEEING TWO ERRORS:
---------------------------

1. ERROR 403: "The given origin is not allowed for the given client ID"
   → This is a GOOGLE CLOUD CONSOLE configuration issue
   
2. ERROR 401: "Invalid Google authentication token"
   → This happens because Google won't issue a valid token when origin is not allowed

FIX BOTH ISSUES (DO THIS FIRST):
---------------------------------

STEP 1: Fix Google Cloud Console (Fixes 403 error)
---------------------------------------------------

1. Go to: https://console.cloud.google.com/
2. Select your project
3. Navigate to: APIs & Services → Credentials
4. Click on your OAuth 2.0 Client ID (the one with Client ID: 867848949678-...)
5. Under "Authorized JavaScript origins", click "ADD URI" and add:
   
   http://localhost:4200
   https://localhost:4200
   
   (Add BOTH if you're not sure which one you're using)
   
6. Under "Authorized redirect URIs" (if present), add:
   
   http://localhost:4200
   https://localhost:4200
   
7. Click "SAVE"
8. Wait 2-3 minutes for changes to propagate
9. Clear your browser cache (Ctrl+Shift+Delete)
10. Restart your Angular dev server

STEP 2: Verify Client ID Matches Everywhere
---------------------------------------------

Backend (appsettings.json):
  "GoogleOAuth": {
    "ClientId": "867848949678-4qjhet7k1vqnpeq88f29crmchds1amri.apps.googleusercontent.com"
  }

Frontend (login.component.ts or wherever you initialize Google):
  google.accounts.id.initialize({
    client_id: "867848949678-4qjhet7k1vqnpeq88f29crmchds1amri.apps.googleusercontent.com",
    ...
  });

Google Cloud Console:
  Should show the SAME Client ID: 867848949678-4qjhet7k1vqnpeq88f29crmchds1amri.apps.googleusercontent.com

ALL THREE MUST MATCH EXACTLY!

STEP 3: Check Backend Logs
---------------------------

After fixing Step 1, try Google login again and check your backend console/logs.
You should see:

  "Validating Google token with ClientId: 867848949678-..."
  "Received Google token (length: XXX, preview: eyJ...)"

If you see errors, they will now be more detailed and tell you exactly what's wrong.

STEP 4: Test Again
------------------

1. Clear browser cache
2. Restart Angular dev server: ng serve
3. Restart backend (if needed)
4. Try Google Sign-In again

COMMON MISTAKES:
----------------

❌ Forgetting to add http://localhost:4200 to Google Console
❌ Adding https://localhost:4200 but using http://localhost:4200
❌ Not waiting for Google changes to propagate (takes 1-3 minutes)
❌ Not clearing browser cache
❌ Client ID mismatch between frontend and backend
❌ Using wrong Client ID (maybe you have multiple OAuth clients)

VERIFICATION CHECKLIST:
-----------------------

Before testing again, verify:

[ ] Google Cloud Console: Added http://localhost:4200 to Authorized JavaScript origins
[ ] Google Cloud Console: Saved changes and waited 2-3 minutes
[ ] Browser: Cleared cache
[ ] Frontend: client_id matches backend appsettings.json
[ ] Backend: appsettings.json has correct ClientId
[ ] Backend: Server restarted (if you changed appsettings.json)
[ ] Frontend: Angular dev server restarted

IF STILL NOT WORKING:
---------------------

1. Check backend console logs - they now show detailed error messages
2. Check browser console - look for any other errors
3. Verify you're using the correct Google account (the one associated with the project)
4. Try creating a NEW OAuth 2.0 Client ID in Google Console and update both frontend and backend
5. Check if you have multiple Google projects - make sure you're editing the right one

DEBUGGING TIP:
--------------

The backend now logs the token payload. Check your backend console/logs to see:
- Token length
- Token preview (first 20 chars)
- Decoded payload (if possible)
- Detailed validation errors

This will help identify if:
- Token is malformed
- Token has wrong audience (Client ID mismatch)
- Token is expired
- Other validation issues

